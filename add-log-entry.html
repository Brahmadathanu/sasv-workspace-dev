<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8">
  <title>SASV WORKSPACE | Add Log Entry</title>

  <!-- 1) Flatpickr CSS for consistent DD-MM-YYYY pickers -->
  <link rel="stylesheet" href="css/flatpickr.min.css">
  <!-- 1a) Confirm Date plugin CSS -->
  <link rel="stylesheet" href="css/plugins/confirmDate/confirmDate.css">

  <!-- 2) Your app styles -->
  <link rel="stylesheet" href="shared/css/style.css">
  <style>
    /* Form controls */
    input, select, textarea { min-height: 2em; padding: 4px; }
    textarea { resize: vertical; }

    /* Conditional sections hidden by default */
    #juiceSection,
    #putamSection,
    #completedOnSection,
    #postProcessingSection,
    #labRefSection,
    #skuSection,
    #transferSection {
      display: none;
      margin-bottom: 16px;
    }

    /* Ensure datalist items unbolded */
    datalist option { font-weight: normal !important; }

    /* Page & header */
    body {
      background: var(--bg-color);
      color: var(--text-color);
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .header-bar h2 { margin: 0; color: #005A8D; }

    /* Form layout */
    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 12px;
    }
    .form-row label {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .locked-field {
      background: var(--disabled-bg, #f3f3f3);
      color: var(--disabled-fg, #f3f3f3);
      cursor: not-allowed;
    }

    /* Buttons */
    .icon-button {
      background: #004d99;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
    }
    .icon-button:hover { background: #003366; }

    /* Dialog overlay */
    #dialogOverlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    #dialogBox {
      background: var(--bg-color);
      color: var(--text-color);
      padding: 20px;
      border-radius: 8px;
      max-width: 320px;
      text-align: center;
    }
    #dialogButtons {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 16px;
    }
    #dialogButtons button {
      padding: 6px 14px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: var(--btn-bg);
      color: var(--btn-text);
    }
    #dialogButtons button:hover {
      background: var(--btn-hover-bg);
    }

    /* Tables for SKUs & Transfer */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
    }
    th, td {
      padding: 8px;
      border: 1px solid #ccc;
      text-align: left;
    }
    td input[type="number"] { width: 4em; }

    /* Anything marked inert won’t receive clicks/tab */
    [inert] {
      pointer-events: none;
      user-select: none;
    }
    /* Optional: stop background scroll when modal is up */
    body.modal-open { overflow: hidden; }
  </style>
</head>
<body data-theme="system">

  <div class="header-bar">
    <h2>Add Log Entry</h2>
    <button id="homeBtn">HOME</button>
  </div>

  <form id="logForm">
    <!-- 1) Log Date + Section -->
    <div class="form-row">
      <label>Log Date:
        <!-- now flatpickr on a text field -->
        <input
          id="log_date"
          name="log_date"
          type="text"
          placeholder="DD-MM-YYYY"
          required
        >
      </label>
      <label>Section:
        <select id="section" name="section_id" required>
          <option value="">-- Select Section --</option>
        </select>
      </label>
    </div>

    <!-- 2) Sub-section + Area -->
    <div class="form-row">
      <label>Sub-section:
        <select id="sub_section" name="subsection_id" required>
          <option value="">-- Select Sub-section --</option>
        </select>
      </label>
      <label>Area:
        <select id="area" name="area_id" required>
          <option value="">-- Select Area --</option>
        </select>
      </label>
    </div>

    <!-- 3) Plant/Machinery + Item -->
    <div class="form-row">
      <label>Plant/Machinery:
        <select id="plant_or_machinery" name="plant_id">
          <option value="">-- Select Plant/Machinery --</option>
        </select>
      </label>
      <label>Item:
        <input
          id="itemInput"
          name="item"
          list="itemList"
          autocomplete="off"
          required
          placeholder="Type to search…"
        >
        <datalist id="itemList"></datalist>
      </label>
    </div>

    <!-- 4) Batch # + Batch Size -->
    <div class="form-row">
      <label>Batch Number:
        <select id="batch_number" name="batch_number" required>
          <option value="">-- Select Batch Number --</option>
        </select>
      </label>
      <label>Batch Size:
        <input id="batch_size" name="batch_size" type="number" readonly>
      </label>
    </div>

    <!-- 5) UOM + Activity -->
    <div class="form-row">
      <label>UOM:
        <input id="batch_uom" name="batch_uom" type="text" readonly>
      </label>
      <label>Activity:
        <select id="activity" name="activity" required>
          <option value="">-- Select Activity --</option>
        </select>
      </label>
    </div>

    <!-- 6) Juice/Decoction + RM QTY/UOM -->
    <div id="juiceSection">
      <div class="form-row">
        <label>Juice/Decoction:
          <select name="juice_or_decoction">
            <option value="">—</option>
            <option>Juice</option>
            <option>Decoction</option>
          </select>
        </label>
        <label>Specify:
          <input name="specify" type="text">
        </label>
      </div>
      <div class="form-row">
        <label>RM Qty:
          <input id="rm_juice_qty" name="rm_juice_qty" type="number" step="0.01" min="0">
        </label>
        <label>RM UOM:
          <select id="rm_juice_uom" name="rm_juice_uom">
            <option value="">--</option>
            <option>Kg</option>
            <option>L</option>
          </select>
        </label>
      </div>
    </div>

    <!-- 7) Putam -->
    <div id="putamSection">
      <div class="form-row">
        <label>Count of Saravam:
          <input name="count_of_saravam" type="number" min="0">
        </label>
        <label>Fuel Type:
          <select name="fuel">
            <option value="">—</option>
            <option>Varali</option>
            <option>Firewood</option>
          </select>
        </label>
      </div>
      <div class="form-row">
        <label>Fuel Under:
          <input name="fuel_under" type="text">
        </label>
        <label>Fuel Over:
          <input name="fuel_over" type="text">
        </label>
      </div>
    </div>

    <!-- 8) Started On + Due Date -->
    <div class="form-row">
      <label>Started On:
        <input
          id="started_on"
          name="started_on"
          type="text"
          placeholder="DD-MM-YYYY"
        >
      </label>
      <label>Due Date:
        <input
          id="due_date"
          name="due_date"
          type="text"
          placeholder="DD-MM-YYYY"
          readonly
        >
      </label>
    </div>

<!-- 9) Status -->
<div class="form-row">
  <label>Status:
    <select id="status" name="status" required>
      <option>Doing</option>
      <option>On Hold</option>
      <option>Done</option>
      <option>In Storage</option>
    </select>
  </label>
</div>

<!-- 9b) Storage Qty + UOM (shown only when “In Storage” is selected) -->
<div id="storageSection" style="display:none; margin-bottom:16px;">
  <div class="form-row">
    <label>Storage Qty:
      <input id="storage_qty" name="storage_qty" type="number" step="0.01" min="0">
    </label>
    <label>UOM:
      <select id="storage_qty_uom" name="storage_qty_uom">
        <option value="">--</option>
        <option>Kg</option>
        <option>L</option>
        <option>Nos</option>
      </select>
    </label>
  </div>
</div>

    <!-- 10) Completed On -->
    <div id="completedOnSection">
      <div class="form-row">
        <label>Completed On:
          <input
            id="completed_on"
            name="completed_on"
            type="text"
            placeholder="DD-MM-YYYY"
          >
        </label>
      </div>
    </div>

    <!-- 11) Qty After Process + UOM -->
    <div id="postProcessingSection">
      <div class="form-row">
        <label>Qty After Process:
          <input name="qty_after_process" type="number" step="0.01" min="0">
        </label>
        <label>UOM:
          <select name="qty_after_process_uom">
            <option value="">--</option>
            <option>Kg</option>
            <option>L</option>
            <option>Nos</option>
          </select>
        </label>
      </div>
    </div>

    <!-- 11b) Lab Ref Number (QA) -->
    <div id="labRefSection">
      <div class="form-row">
        <label>Lab Ref Number:
          <input name="lab_ref_number" type="text">
        </label>
      </div>
    </div>

    <!-- 11c) SKU Breakdown -->
    <div id="skuSection">
      <h3>SKU Breakdown</h3>
      <table id="skuTable">
        <thead>
          <tr><th>Pack Size</th><th>UOM</th><th>Count</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- 11d) Transfer to FG Store -->
    <div id="transferSection">
      <h3>Transfer to FG Store</h3>
      <table id="transferTable">
        <thead>
          <tr><th>Pack Size</th><th>UOM</th><th>On-Hand</th><th>Transfer Qty</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- 12) Remarks -->
    <div class="form-row">
      <label>Remarks:
        <textarea name="remarks" rows="3"></textarea>
      </label>
    </div>

    <!-- 12) Form actions -->
    <div class="form-actions">
      <button id="btnSubmit"      type="submit"  class="primary-btn">Submit Log</button>
      <button id="btnSubmitNew"   type="button"  class="primary-btn">Submit &amp; New</button>
      <button id="btnClear"       type="button"  class="clear-btn push-right">Clear</button>
    </div>
  </form>

  <!-- Dialog overlay -->
    <div id="dialogOverlay">
     <div id="dialogBox">
        <div id="dialogMessage"></div>
        <div id="dialogButtons">
          <button id="btnYes">Yes</button>
          <button id="btnNo">No</button>
          <button id="btnOk">OK</button>
        </div>
      </div>
    </div>

  <!-- Overlay for “open Doing/In Storage rows” -->
<div id="openRowsOverlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.5); z-index:1001; align-items:center; justify-content:center;">
  <div style="background:var(--bg-color); color:var(--text-color); padding:20px; border-radius:8px; max-width:520px; width:90%;">
    <h3 style="margin-top:0;">Existing Open Logs Found</h3>
    <p id="openRowsMsg" style="margin:8px 0 12px;"></p>
    <div style="max-height:220px; overflow:auto;">
      <table style="width:100%; border-collapse:collapse;">
        <thead>
          <tr>
            <th></th>
            <th>Activity</th>
            <th>Section</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="openRowsTbody"></tbody>
      </table>
    </div>
    <div style="text-align:right; margin-top:14px;">
      <button id="btnOpenRowGo"   class="icon-button">Go to Update</button>
      <button id="btnOpenRowSkip" class="icon-button">Continue Anyway</button>
    </div>
  </div>
</div>

  <!-- 3) Flatpickr JS + plugin -->
  <script src="css/flatpickr.min.js"></script>
  <script src="css/plugins/confirmDate/confirmDate.js"></script>

  <!-- 4) Your renderer JS (init Flatpickr + all existing logic) -->
  <script type="module" src="js/log-add.js"></script>
</body>
</html>