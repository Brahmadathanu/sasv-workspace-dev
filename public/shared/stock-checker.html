<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- App title -->
    <title>SASV Stock Checker</title>

    <!-- PWA essentials -->
    <meta name="theme-color" content="#005A8D" />

    <!-- iOS PWA support -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="StockChecker" />
    <link rel="apple-touch-icon" href="/utilities-hub/icons/icon-192x192.png" />
    <link
      rel="apple-touch-icon"
      sizes="512x512"
      href="/utilities-hub/icons/icon-512x512.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/utilities-hub/icons/icon-192x192.png"
    />

    <!-- Vendor + shared CSS -->
    <!-- TomSelect removed: using native paginated autocomplete -->
    <link rel="stylesheet" href="../shared/css/style.css" />

    <!-- Component styles -->
    <style>
      /* ───────────────────────────────── Base & layout ───────────────────────────────── */
      :root {
        --gap: 12px;
        --pad: 10px;
        --radius: 8px;
        --border: #e5e7eb;
        --muted: #6b7280;
        --ink: #111827;
        --bg: #fff;
        --bg-soft: #f9fafb;
        --primary: #2563eb;
      }

      body {
        background: #fafafa;
      }

      .sc-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 8px;
      }
      .sc-actions {
        display: flex;
        gap: 8px;
      }
      /* Explode controls sizing to fit narrow screens */
      .explode-row {
        margin: 8px 0;
      }
      .explode-controls {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        align-items: center;
      }
      .explode-controls .sc-btn {
        padding: 6px 10px;
        font-size: 13px;
      }
      @media (max-width: 680px) {
        .explode-controls .sc-btn {
          padding: 5px 8px;
          font-size: 12px;
          margin: 0 !important;
        }
        .explode-controls {
          gap: 6px;
        }
      }
      .sc-btn {
        padding: 8px 12px;
        border-radius: 6px;
        border: 1px solid #d1d5db;
        background: var(--bg);
        cursor: pointer;
      }
      .sc-btn.primary {
        background: #0a62c3;
        color: #fff;
        border-color: #0a62c3;
      }
      /* Visual indicator when filters are active */
      .sc-btn.filters-active {
        background: #0a62c3;
        color: #fff;
        border-color: #074a8a;
        box-shadow: 0 2px 6px rgba(10, 98, 195, 0.18);
      }

      /* Icon-only buttons (compact controls) should show the icon in the
         primary blue when active rather than inverting to a white icon.
         This keeps the full-width Filters button behaviour, but makes
         compact icon buttons (explode) visually consistent. */
      .sc-btn.sc-btn-icon.filters-active {
        background: #0a62c3;
        color: #fff;
        border-color: #074a8a;
        box-shadow: 0 2px 6px rgba(10, 98, 195, 0.18);
      }

      /* Ensure the specific explode button visually matches the Filters
         button when active by targeting it with high specificity. */
      button#explode-details-btn.filters-active {
        background: #0a62c3 !important;
        color: #fff !important;
        border-color: #074a8a !important;
        box-shadow: 0 2px 6px rgba(10, 98, 195, 0.18) !important;
      }
      /* Make sure SVG icon strokes/fills follow the text color when a
         button is active. */
      .sc-btn.filters-active svg,
      button#explode-details-btn.filters-active svg {
        stroke: #fff !important;
        fill: #fff !important;
      }

      /* ───────────────────────────────── Filters row ───────────────────────────────── */
      .sc-filters {
        display: grid;
        gap: var(--gap);
        /* Use fractional units so the first two columns (Item / Pack Size)
           share available width proportionally and stretch to the full
           line. minmax(0, ...) and min-width:0 on children allow them to
           shrink without overflow on narrow containers. */
        grid-template-columns: minmax(160px, 3fr) minmax(90px, 1fr) 1fr 1fr;
        width: 100%;
        justify-items: stretch;
        margin: 6px 0 4px; /* tightened vertical spacing */
        align-items: end;
      }
      .sc-filters label {
        display: flex;
        flex-direction: column;
        gap: 6px;
        font-size: 0.9rem;
        min-width: 0; /* allow the child to shrink inside grid */
      }
      /* Pack Size label should sit vertically centered within the filters row */
      .sc-filters .uom-inline {
        align-self: center;
        min-width: 140px;
      }
      .sc-filters select,
      .sc-filters input {
        padding: 8px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        background: var(--bg);
      }

      /* Pack size + UOM inline */
      .pack-uom {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        width: 100%;
        white-space: nowrap;
        position: relative;
      }
      /* reserve space on the right of the input for the clear button + UOM */
      .pack-uom input {
        flex: 1 1 auto;
        min-width: 0;
        padding-right: 72px; /* clear button (24px) + gap + uom width */
      }
      /* place clear button inside the input area, before the UOM text */
      .pack-uom .input-clear-btn {
        right: 50px; /* position inside input, to the left of UOM */
        z-index: 2;
      }
      /* make UOM a fixed area to the right of the input */
      .pack-uom .uom-text {
        flex: 0 0 32px;
        text-align: right;
        pointer-events: none;
        margin-left: 6px;
        font-weight: 600;
      }
      .uom-text {
        padding: 0;
        margin: 0;
        border: 0;
        background: transparent;
        color: #374151;
        font-weight: 600;
        line-height: 1.4;
      }

      /* ───────────────────────────────── Quick chips ───────────────────────────────── */
      .sc-quick {
        margin: 6px 0 10px;
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        justify-content: flex-start; /* left-align the MOS/Rasoushadhi buttons */
      }
      .chip {
        display: inline-block;
        padding: 6px 12px;
        margin: 4px 0;
        border: 1px solid #d1d5db;
        border-radius: 9999px;
        background: #f9fafb;
        color: var(--ink);
        line-height: 1.2;
        cursor: pointer;
        transition: background 0.2s, color 0.2s, border-color 0.2s,
          box-shadow 0.2s;
      }
      .chip:hover {
        background: #f3f4f6;
      }
      .sc-quick .chip[aria-pressed="true"],
      .sc-quick .chip.is-active,
      /* quick filters when placed inside modal */
      .sc-quick-modal .chip[aria-pressed="true"],
      .sc-quick-modal .chip.is-active {
        background: var(--primary) !important;
        color: #fff !important;
        border-color: var(--primary) !important;
      }
      .chip:focus-visible {
        outline: 2px solid var(--primary);
        outline-offset: 2px;
      }

      /* ───────────────────────────────── Drawers ───────────────────────────────── */
      .drawer {
        border: 1px solid var(--border);
        border-radius: var(--radius);
        background: var(--bg);
        margin: 8px 0;
      }
      .drawer > summary {
        cursor: pointer;
        padding: 10px 12px;
        font-weight: 600;
      }
      .drawer[open] > .drawer-body {
        padding: 12px;
        border-top: 1px solid var(--border);
      }
      .drawer-body {
        display: grid;
        gap: 12px;
      }
      .drawer-heading {
        margin: 0;
        font-size: 0.95rem;
        color: #374151;
      }

      /* Classification grid: 4-up desktop, 2-up tablet, 1-up mobile */
      .drawer-grid {
        display: grid;
        gap: 12px;
        grid-template-columns: repeat(4, minmax(180px, 1fr));
      }
      @media (max-width: 960px) {
        .drawer-grid {
          grid-template-columns: repeat(2, minmax(180px, 1fr));
        }
      }
      @media (max-width: 600px) {
        .drawer-grid {
          grid-template-columns: 1fr;
        }
      }
      /* Force advanced exclusions to two columns (two per row) in modal
         with preferred column width not exceeding 520px */
      #drawer-advanced .drawer-grid {
        grid-template-columns: repeat(2, minmax(180px, 520px));
        justify-content: center;
        column-gap: 12px;
      }
      @media (max-width: 520px) {
        /* Use single column layout on small viewports to avoid narrow columns
           that force placeholder text to wrap. */
        #drawer-advanced .drawer-grid {
          grid-template-columns: 1fr;
        }
      }
      /* Modal styles */
      .sc-modal {
        position: fixed;
        inset: 0;
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }
      .sc-modal-backdrop {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.45);
        backdrop-filter: blur(2px);
      }
      .sc-modal-panel {
        position: relative;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 18px 48px rgba(6, 10, 15, 0.18);
        /* responsive width: compact on small screens, wider on desktop */
        width: min(760px, 92vw);
        max-width: calc(100% - 40px);
        z-index: 1010;
        transform: translateY(0);
        transition: transform 180ms ease, opacity 180ms ease;
        /* Keep modal panel within viewport and allow body scrolling */
        max-height: calc(100vh - 80px);
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      /* Improved styling for Item Details modal (ERP-friendly) */
      #sc-row-modal .sc-modal-panel {
        width: min(820px, 96vw);
        max-width: 920px;
      }
      #sc-row-modal .sc-modal-header h3 {
        font-size: 1.15rem;
        color: #073b5a;
      }
      #sc-row-modal .sc-modal-body {
        display: grid;
        gap: 14px;
        padding: 18px 20px;
        align-items: start;
      }
      #sc-row-header {
        font-size: 1.02rem;
        font-weight: 700;
        color: #0b3b66;
        margin-bottom: 2px;
      }
      #sc-row-classif {
        color: var(--muted);
        font-size: 0.95rem;
        margin-bottom: 6px;
      }
      /* make qty/value cards look like ERP info cards */
      #sc-row-modal .sc-modal-body > div.grid-2,
      #sc-row-qty,
      #sc-row-value {
        box-sizing: border-box;
      }
      #sc-row-qty,
      #sc-row-value {
        background: #ffffff;
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 12px 14px;
        min-height: 86px;
      }
      #sc-row-qty strong,
      #sc-row-value strong {
        display: block;
        font-size: 0.95rem;
        margin-bottom: 8px;
        color: #0f172a;
      }
      /* numeric alignment and monospace for easy scanning */
      #sc-row-qty div,
      #sc-row-value div {
        display: flex;
        justify-content: space-between;
        gap: 12px;
        font-size: 0.95rem;
        padding: 4px 0;
      }
      #sc-row-qty div span.num,
      #sc-row-value div span.num {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;
        color: #0b3b66;
        font-weight: 600;
      }
      /* Two-column layout on desktop, stack on small screens */
      #sc-row-modal .sc-modal-body > div[style] {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      @media (max-width: 680px) {
        #sc-row-modal .sc-modal-body > div[style] {
          grid-template-columns: 1fr;
        }
      }
      /* === Value modal: ERP-friendly summary card === */
      #sc-value-modal .sc-modal-panel {
        width: min(620px, 94vw);
        max-width: 760px;
      }
      #sc-value-modal .sc-modal-header h3 {
        font-size: 1.05rem;
        color: #073b5a;
      }
      #sc-value-modal .sc-modal-body {
        padding: 16px 18px 18px;
        display: block;
      }
      #sc-value-body-content {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px 14px;
        align-items: start;
      }
      #sc-value-body-content > div {
        background: #fff;
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 10px 12px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      /* Distinct card backgrounds for each value box for quick scanning */
      #sc-value-body-content > div:nth-child(1) {
        background: #f0f9ff; /* pale blue */
        border-color: rgba(3, 105, 161, 0.12);
      }
      #sc-value-body-content > div:nth-child(2) {
        background: #ecfdf5; /* pale green */
        border-color: rgba(6, 95, 70, 0.08);
      }
      #sc-value-body-content > div:nth-child(3) {
        background: #fff7ed; /* pale amber */
        border-color: rgba(168, 85, 18, 0.08);
      }
      #sc-value-body-content > div:nth-child(4) {
        background: #f8fafc; /* pale slate */
        border-color: rgba(15, 23, 42, 0.04);
      }
      #sc-value-body-content > div .label {
        color: var(--muted);
        font-size: 0.88rem;
      }
      #sc-value-body-content > div .value {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;
        color: #0b3b66;
        font-weight: 700;
        font-size: 1.02rem;
      }
      #sc-value-modal .sc-modal-footer {
        padding: 12px 16px;
        border-top: 1px solid #f1f5f9;
        background: linear-gradient(
          180deg,
          rgba(250, 250, 252, 0.4),
          rgba(255, 255, 255, 0)
        );
      }
      #sc-value-snapshot {
        color: var(--muted);
        font-size: 0.9rem;
      }
      @media (max-width: 560px) {
        #sc-value-body-content {
          grid-template-columns: 1fr;
        }
      }

      /* Make the Value pill slightly more compact so the paginator fits on small screens
         and allow it to shrink further on narrow viewports. */
      #sc-total-value {
        font-weight: 700;
        font-size: 0.88rem;
        padding: 3px 6px;
        /* adopt the previous row-count pill colours */
        background: #eef2ff;
        color: #3730a3;
        border-color: rgba(15, 23, 42, 0.06);
        box-shadow: 0 1px 0 rgba(0, 0, 0, 0.03) inset;
        min-width: 56px;
        max-width: 320px; /* general cap */
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        flex: 0 1 auto; /* allow shrinking */
      }

      /* Icon-only presentation helpers: keep the textual span for larger
         viewports but hide it and show only the rupee SVG on very narrow
         screens. The `sc-pill-icon` class is applied by default so JS can
         still find the element by id without changes. */
      .sc-pill .sc-pill-text {
        display: inline-block;
      }
      /* Hide inline SVG by default (wide screens). It will be shown only
         for very narrow viewports where the pill switches to icon-only mode. */
      .sc-pill svg {
        display: none;
      }
      .sc-pill.sc-pill-icon svg {
        width: 16px;
        height: 16px;
        vertical-align: middle;
        fill: currentColor;
      }

      /* Tighter constraints for very narrow viewports (phones) */
      @media (max-width: 420px) {
        #sc-total-value {
          font-size: 0.82rem;
          padding: 2px 6px;
          max-width: 140px;
          min-width: 48px;
        }
        /* reduce spacing between meta items so paginator fits */
        .sc-meta {
          gap: 6px;
        }
      }

      /* Extra-tight layout for very narrow phones (e.g. iPhone 12 width 390px) */
      @media (max-width: 400px) {
        .sc-meta {
          gap: 4px;
          align-items: center;
        }
        #sc-total-value {
          font-size: 0.78rem;
          padding: 2px 6px;
          max-width: 110px;
          min-width: 44px;
        }
        /* Make the value pill an icon-only small square on very narrow
           viewports. Preserve the pill background and color so it reads as
           the same control in compact form. */
        #sc-total-value.sc-pill-icon {
          padding: 5px;
          background: #eef2ff; /* match .sc-pill */
          border: 1px solid rgba(15, 23, 42, 0.06);
          color: #3730a3; /* match .sc-pill text color */
          min-width: 36px;
          max-width: 36px;
          border-radius: 8px;
          gap: 0;
          display: inline-flex;
          align-items: center;
          justify-content: center;
        }
        #sc-total-value.sc-pill-icon .sc-pill-text {
          display: none;
        }
        #sc-total-value.sc-pill-icon svg {
          display: inline-block;
          width: 20px;
          height: 20px;
        }
        /* Keep the paginator compact and prevent its buttons from wrapping
           by forcing it to the right and hiding the textual page label. */
        .pagination {
          margin-left: auto;
          display: inline-flex;
          gap: 6px;
          align-items: center;
          flex: 0 0 auto;
        }
        .pagination .sc-btn {
          width: 34px;
          padding: 6px;
        }
        /* Hide textual page indicator to save space; icons remain available */
        #sc-page {
          display: none;
        }
      }
      .sc-modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 14px 16px;
        border-bottom: 1px solid #f1f5f9;
      }
      .sc-modal-header h3 {
        margin: 0;
        font-size: 1.05rem;
        color: #0f172a;
      }
      /* Toast for single-tap helper */
      #sc-single-toast {
        pointer-events: none;
      }
      .sc-modal-body {
        padding: 14px 16px 18px;
        overflow: auto;
        flex: 1 1 auto;
        max-height: calc(100vh - 220px);
      }
      /* Modal action layout */
      .modal-actions {
        display: grid;
        gap: 10px;
      }
      .sc-btn.block,
      .sc-btn.sc-btn-block {
        display: block;
        width: 100%;
        text-align: center;
      }
      .sc-btn.primary {
        background: #0a62c3;
        color: #fff;
        border-color: #0a62c3;
        padding: 10px 12px;
        font-weight: 600;
      }
      .sc-btn.secondary {
        background: #f3f4f6;
        color: #0f172a;
        border-color: #e6e9ee;
      }
      /* Visual distinction for disabled buttons */
      .sc-btn[disabled] {
        opacity: 0.56;
        cursor: not-allowed;
        color: #9ca3af;
        background: #f9fafb;
        border-color: #eef2f6;
      }
      /* Make secondary Reset button more visible when enabled */
      .sc-btn.secondary:not([disabled]) {
        background: #ffffff;
        color: #0f172a;
        border-color: #d1d5db;
        box-shadow: 0 1px 0 rgba(15, 23, 42, 0.03);
      }
      .sc-btn.icon {
        padding: 8px;
        min-width: 40px;
      }
      /* Hide HOME label on small screens to save space */
      @media (max-width: 520px) {
        #homeBtn .home-label {
          display: none;
        }
        #homeBtn svg {
          margin-right: 0;
        }
        #homeBtn {
          padding-left: 8px;
          padding-right: 8px;
        }
      }
      .sc-export-drawer {
        margin-top: 8px;
        border: 1px solid #eef2f6;
        padding: 10px;
        border-radius: 8px;
        background: #fbfdff;
      }
      .sc-export-drawer .sc-btn {
        margin-bottom: 8px;
      }

      /* MOS rows: Label | Op | V1 | V2 | Exclude-null (tight, aligned) */
      .mos-row {
        display: grid;
        grid-template-columns: 120px 88px 120px 120px max-content;
        gap: 10px;
        align-items: center;
      }
      .mos-row > .mos-label {
        font-weight: 600;
        color: #374151;
        white-space: nowrap;
      }
      .mos-row select,
      .mos-row input[type="number"] {
        height: 32px;
        padding: 6px 8px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        width: 100%;
        box-sizing: border-box;
        background: var(--bg);
      }
      .mos-row input[type="number"] {
        text-align: right;
      }
      .mos-row select[id^="mos"][id$="-op"] {
        min-width: 72px;
        max-width: 120px;
        width: auto;
      }
      .mos-row input[id^="mos"][id$="-v1"],
      .mos-row input[id^="mos"][id$="-v2"] {
        min-width: 88px;
        width: 100%;
        box-sizing: border-box;
      }

      /* On narrower viewports, make MOS controls more compact */
      @media (max-width: 560px) {
        .mos-row {
          grid-template-columns: 100px 72px 1fr 1fr max-content;
        }
        .mos-row select[id^="mos"][id$="-op"] {
          min-width: 64px;
        }
      }
      .mos-row .nullchk {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        white-space: nowrap;
        color: #374151;
      }
      /* Ensure drawer content fits within modal/card */
      .drawer-body {
        overflow: auto;
        max-width: 100%;
        box-sizing: border-box;
      }
      .drawer-body .drawer-grid select,
      .drawer-body .drawer-grid input {
        width: 100%;
        box-sizing: border-box;
        max-width: 100%;
      }
      .multi-list {
        left: 0;
        right: auto;
        min-width: 200px;
        max-width: calc(100% - 8px);
      }
      /* Multi-checkbox dropdown for advanced exclusions */
      .multi-checkbox {
        position: relative;
        width: 100%;
      }
      .multi-btn {
        width: 100%;
        text-align: left;
        padding: 8px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        background: var(--bg);
        cursor: pointer;
        /* allow label to wrap across lines (no ellipsis) */
        white-space: normal;
        overflow-wrap: anywhere;
        box-sizing: border-box;
      }
      .multi-list {
        position: absolute;
        z-index: 60;
        left: 0;
        right: auto;
        width: auto;
        min-width: 180px;
        max-width: calc(100vw - 32px);
        box-sizing: border-box;
        .mc-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding-bottom: 6px;
          border-bottom: 1px solid #f1f5f9;
          margin-bottom: 6px;
        }
        .mc-close-btn {
          border: none;
          background: transparent;
          cursor: pointer;
          font-size: 14px;
          padding: 4px 6px;
        }
        max-height: 220px;
        overflow: auto;
        margin-top: 6px;
        padding: 8px;
        background: #fff;
        border: 1px solid #e6eef8;
        border-radius: 6px;
        box-shadow: 0 6px 18px rgba(16, 24, 40, 0.08);
      }
      .multi-list .mc-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 4px;
      }
      .multi-list .mc-item input[type="checkbox"] {
        width: 16px;
        height: 16px;
      }
      .mos-row .nullchk input[type="checkbox"] {
        width: 16px;
        height: 16px;
        accent-color: var(--primary);
      }

      .drawer-actions {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-top: 10px;
      }

      /* MOS responsive collapse */
      @media (max-width: 900px) {
        .mos-row {
          grid-template-columns: 110px 110px 1fr 1fr max-content;
          gap: 8px;
        }
      }
      @media (max-width: 700px) {
        .mos-row {
          grid-template-columns: 120px 110px 1fr;
          row-gap: 8px;
        }
        .mos-row input[id^="mos"][id$="-v2"] {
          grid-column: 3 / 4;
        }
        .mos-row .nullchk {
          grid-column: 1 / -1;
          justify-self: start;
        }
      }

      /* ───────────────────────────────── Meta + table ───────────────────────────────── */
      .sc-meta {
        display: flex;
        gap: 10px;
        align-items: center;
        color: var(--muted);
        font-size: 0.9rem;
        margin: 4px 0; /* tightened */
        flex-wrap: nowrap; /* keep pills on single line */
        overflow: hidden;
      }
      /* Ensure pills and pagination buttons are vertically centered
         even if their internal padding/line-height differs. */
      .sc-meta > * {
        display: inline-flex;
        align-items: center;
      }
      .sc-meta .sc-pill {
        align-self: center;
      }
      .sc-meta .pagination {
        align-self: center;
      }
      .sc-pill {
        padding: 6px 10px;
        border-radius: 999px;
        background: #eef2ff;
        color: #3730a3;
        font-size: 12px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        white-space: nowrap;
        flex: 0 1 auto; /* allow pills to shrink on narrow viewports */
        max-width: 240px;
        overflow: hidden;
        text-overflow: ellipsis;
        min-height: 34px;
        box-sizing: border-box;
        line-height: 1;
      }

      /* Make the row-count more prominent for ERP-style modules */
      #sc-count {
        font-size: 0.95rem;
        font-weight: 600;
        padding: 6px 10px;
        background: #eef2ff;
        color: #3730a3;
        box-shadow: 0 1px 0 rgba(0, 0, 0, 0.03) inset;
        min-width: 64px;
        max-width: 220px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        min-height: 34px;
        display: inline-flex;
        align-items: center;
        box-sizing: border-box;
      }

      /* Constrain the table card to the viewport so page-level vertical
         scroll only appears when the entire page truly overflows. The
         offset accounts for header, filters, controls and paddings. */
      :root {
        --sc-table-offset: 360px; /* adjust if header/filters grow */
      }
      .table-wrap {
        border: 1px solid var(--border);
        border-radius: var(--radius);
        overflow: auto;
        position: relative;
        max-height: calc(100vh - var(--sc-table-offset));
        background: var(--bg);
      }
      /* sc-msg placed inside the table card should overlay without
           contributing to document flow */
      .table-wrap .sc-msg-overlay {
        position: absolute;
        left: 12px;
        right: 12px;
        bottom: 8px;
        padding: 10px;
        color: #b45309;
        background: transparent;
        z-index: 30;
        pointer-events: auto;
      }
      /* On small screens the top area consumes more vertical space (drawers
         collapse), so reduce the offset to give the table more room. */
      @media (max-width: 700px) {
        :root {
          --sc-table-offset: 300px;
        }
      }
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
        background: var(--bg);
      }
      /* Collapsed: keep body cells on a single line (no wrapping) and show
         an ellipsis when content overflows. Allow headers to wrap (thead
         rules remain unchanged). When an explode class is active keep nowrap
         behavior as well. */
      /* Collapsed default: let cells stay on one line (no wrapping) and
         allow the table to grow beyond the container so a horizontal
         scrollbar appears only when necessary. Headers can still wrap. */
      table.collapsed-default {
        table-layout: auto;
        min-width: 100%;
      }

      /* Body cells: do not wrap and do not ellipsize; let overflow create
         horizontal scroll handled by .table-wrap */
      table.collapsed-default tbody td,
      table.explode-stock-active tbody td,
      table.explode-demand-active tbody td,
      table.explode-mos-active tbody td {
        white-space: nowrap;
        overflow: visible;
        text-overflow: clip;
      }

      /* Give Item column priority but don't force a large min-width so
         the table may size naturally. Set to 0 so small viewports can
         reflow without leaving gaps. */
      table.collapsed-default th.col-item {
        min-width: 0;
        /* prefer a larger share of available table width so item names
           remain readable; percentage avoids hard reserved gaps */
        width: 34%;
      }
      table.collapsed-default tbody td.col-item,
      table.explode-stock-active tbody td.col-item,
      table.explode-demand-active tbody td.col-item,
      table.explode-mos-active tbody td.col-item {
        white-space: normal;
        /* prefer breaking at word boundaries rather than between letters */
        overflow-wrap: break-word;
        word-break: normal;
        width: 34%;
      }

      /* Numeric/meta columns remain compact but will cause scroll when
         necessary; allow explode modes to increase their min-width. */
      table.collapsed-default th.col-meta,
      table.collapsed-default td.col-meta {
        min-width: 72px;
      }
      table.collapsed-default th.col-stock,
      table.collapsed-default td.col-stock,
      table.collapsed-default th.col-demand,
      table.collapsed-default td.col-demand,
      table.collapsed-default th.col-mos,
      table.collapsed-default td.col-mos,
      table.collapsed-default th.col-overall,
      table.collapsed-default td.col-overall {
        min-width: 64px;
      }
      table.explode-stock-active th.col-stock,
      table.explode-stock-active td.col-stock,
      table.explode-demand-active th.col-demand,
      table.explode-demand-active td.col-demand,
      table.explode-mos-active th.col-mos,
      table.explode-mos-active td.col-mos {
        min-width: 110px;
      }
      thead th {
        position: sticky;
        top: 0;
        background: var(--bg-soft);
        border-bottom: 1px solid var(--border);
        padding: 8px;
        text-align: center; /* center headers by default */
        /* Allow header wrapping between words to reduce horizontal scroll */
        white-space: normal;
        word-break: normal;
        overflow-wrap: normal;
      }
      thead th:first-child {
        text-align: center;
      } /* “Item” header centered */
      tbody td {
        border-top: 1px solid rgba(15, 23, 42, 0.06);
        padding: 8px;
        text-align: center; /* center cells by default */
        vertical-align: middle;
      }
      tbody td:first-child {
        text-align: left;
      } /* “Item” column left */

      .pagination {
        margin-left: auto;
        display: flex;
        gap: 6px;
        align-items: center; /* vertically center paginator contents with pills */
      }

      /* ───────────────────────────────── Breakpoint tweak for filters ───────────────────────────────── */
      @media (max-width: 960px) {
        .sc-filters {
          grid-template-columns: minmax(140px, 2.5fr) minmax(80px, 1fr) 1fr 1fr;
        }
        .sc-filters label {
          min-width: 0;
        }
      }
      @media (max-width: 520px) {
        .sc-filters {
          /* Stack on narrow screens: Item then Pack Size then others */
          grid-template-columns: 1fr;
        }
        .sc-quick {
          justify-content: center;
        }
      }
      /* Intermediate narrow breakpoint: keep Pack Size inline but narrow
         the field; once viewport is smaller than 680px we'll allow the
         Pack Size to stay beside Item if space allows, otherwise it will
         naturally wrap to the next line. */
      @media (max-width: 680px) {
        /* Allow Item + Pack Size to keep proportion but shrink; when the
           container is too narrow they will naturally wrap due to the
           single-column rule below at 520px. */
        .sc-filters {
          grid-template-columns: minmax(120px, 2fr) minmax(80px, 1fr) 1fr;
        }
      }

      /* === Exclude (multi-select) alignment fix === */
      .drawer-grid {
        display: grid;
        gap: 12px;
        grid-template-columns: repeat(4, minmax(220px, 1fr));
        align-items: start; /* top-align each cell */
      }

      /* Make each cell a tidy vertical stack */
      .drawer-grid > label {
        display: flex;
        flex-direction: column;
        gap: 6px;
        align-self: start; /* ensure labels stick to top */
      }

      /* Normalize the multiselects so all boxes match height/width */
      .drawer-grid select[multiple] {
        width: 100%;
        min-height: 9.5rem; /* same visible height for all */
        padding: 8px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        background: #fff;
        box-sizing: border-box;
      }

      /* Optional: single-selects inside this grid match style too */
      .drawer-grid select:not([multiple]) {
        width: 100%;
        padding: 8px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        background: #fff;
        box-sizing: border-box;
      }

      /* Responsive: 2-up tablet, 1-up mobile */
      @media (max-width: 960px) {
        .drawer-grid {
          grid-template-columns: repeat(2, minmax(220px, 1fr));
        }
      }
      @media (max-width: 600px) {
        .drawer-grid {
          grid-template-columns: 1fr;
        }
        .drawer-grid select[multiple] {
          min-height: 8.5rem;
        } /* slightly shorter on mobile */
      }
      /* Highlight selected rows by coloring each cell so it overlays per-cell backgrounds */
      .selected-row td {
        background-color: #ffeeba !important; /* overlays .col-overall */
      }
      /* Autocomplete dropdown for Item search */
      .ac-list {
        position: absolute;
        left: 0;
        right: 0;
        top: calc(100% + 6px);
        background: #fff;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        max-height: 260px;
        overflow: auto;
        box-shadow: 0 8px 22px rgba(2, 6, 23, 0.12);
        z-index: 1200;
      }
      /* Make table rows appear clickable and prevent accidental text selection */
      #sc-table tbody tr {
        cursor: pointer;
      }
      #sc-table tbody td {
        -webkit-user-select: none; /* Safari */
        -moz-user-select: none; /* Firefox */
        -ms-user-select: none; /* IE10+ */
        user-select: none; /* Standard */
        -webkit-touch-callout: none; /* iOS long press */
      }
      .ac-item {
        padding: 8px 10px;
        font-size: 14px;
        cursor: pointer;
      }
      .ac-item[aria-selected="true"],
      .ac-item:hover {
        background: #eef2ff;
      }
      /* widen input and make it use full available width */
      .autocomplete input#sc-item {
        width: 100%;
        box-sizing: border-box;
        padding: 8px 10px;
        font-size: 14px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        background: var(--bg, #fff);
      }
      .ac-loading {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 10px;
        color: var(--muted, #6b7280);
      }
      .ac-spinner {
        width: 14px;
        height: 14px;
        border: 2px solid rgba(15, 23, 42, 0.12);
        border-top-color: var(--primary, #2563eb);
        border-radius: 50%;
        animation: ac-spin 0.9s linear infinite;
        flex: 0 0 14px;
      }
      /* Input clear button styles (reused from explorer) */
      .input-with-icon {
        position: relative;
      }
      .input-with-icon input[type="text"]::-ms-clear,
      .input-with-icon input[type="text"]::-ms-reveal {
        display: none;
        width: 0;
        height: 0;
      }
      .input-with-icon input[type="text"]::-webkit-search-decoration,
      .input-with-icon input[type="text"]::-webkit-search-cancel-button,
      .input-with-icon input[type="text"]::-webkit-search-results-button,
      .input-with-icon input[type="text"]::-webkit-search-results-decoration {
        display: none;
      }
      .input-with-icon input[type="text"] {
        padding-right: 44px;
      }
      .input-clear-btn {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        width: 28px;
        height: 28px;
        border: none;
        background: none;
        color: var(--erp-muted, #6b7280);
        cursor: pointer;
        border-radius: 4px;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 0;
      }
      .input-clear-btn svg {
        width: 14px;
        height: 14px;
      }
      .input-clear-btn:focus {
        outline: 2px solid var(--erp-primary, #2563eb);
        outline-offset: 2px;
      }
      @keyframes ac-spin {
        to {
          transform: rotate(360deg);
        }
      }
      /* Force-hide native details/summary markers in Chromium/Electron */
      details.drawer > summary::-webkit-details-marker {
        display: none !important;
      }
      details.drawer > summary::marker {
        content: none !important;
        display: none !important;
      }
      details.drawer > summary::before {
        content: none !important;
      }
      /* Inline chevron rotation for open state */
      .drawer > summary .chev {
        transition: transform 160ms ease;
        transform-origin: center;
      }
      details.drawer[open] > summary .chev {
        transform: rotate(90deg);
      }
      /* Sorting caret visuals for sc-table (ensures carets visible on this page) */
      #sc-table thead th {
        cursor: pointer;
        position: sticky;
        top: 0;
        user-select: none;
        overflow: visible;
        padding-right: 12px;
        background: var(--bg);
        z-index: 6;
      }

      /* Paginator: always show icons-only (SVG) and hide text labels.
         Style Prev/Next as icon-only controls with a distinct color, no
         visible bounding box (transparent background), but keep focus
         outlines for accessibility. Tooltips provided via `title`. */
      .pagination .sc-btn {
        padding: 6px;
        width: 32px;
        min-width: 32px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: transparent;
        border: none;
        box-shadow: none;
        color: #0a62c3; /* navigator color */
        border-radius: 6px;
      }
      .pagination .sc-btn svg {
        width: 14px;
        height: 14px;
        vertical-align: middle;
        margin: 0;
      }
      .pagination .sc-btn:hover:not([disabled]) {
        background: rgba(10, 98, 195, 0.06);
      }
      .pagination .sc-btn:focus-visible {
        outline: 2px solid rgba(10, 98, 195, 0.18);
        outline-offset: 2px;
        border-radius: 6px;
      }
      .pagination .sc-btn[disabled] {
        opacity: 0.44;
        color: #9ca3af;
        cursor: not-allowed;
      }
      .pagination .pbtn-label {
        display: none !important;
      }

      /* Inline Details button placed before the Item text */
      .sc-row-details {
        margin: 0;
        /* show only the SVG with a small tappable area */
        padding: 6px;
        min-width: 0;
        width: auto;
        height: auto;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: transparent;
        color: #0d9488; /* teal icon color */
        border: none;
        box-shadow: none;
        vertical-align: middle;
        flex-shrink: 0;
      }
      .sc-row-details:focus-visible {
        outline: 2px solid rgba(3, 105, 161, 0.18);
        outline-offset: 2px;
        border-radius: 6px;
      }
      .sc-row-details svg {
        width: 12px;
        height: 12px;
        display: block;
      }

      /* Explode controls: compact checkbox chips (ERP style) */
      #drawer-explode {
        border: none; /* remove card border for this drawer */
        background: transparent;
      }
      #drawer-explode > summary {
        padding: 0;
      }
      /* Compact drawer trigger button to save horizontal space */
      #explode-details-btn {
        padding: 6px 8px;
        font-size: 13px;
        height: 34px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border-radius: 6px;
        border: 1px solid rgba(15, 23, 42, 0.06);
        background: #fff;
        box-shadow: none;
      }
      #explode-details-btn .chev {
        width: 12px;
        height: 12px;
      }
      /* Equalize vertical spacing between filters, meta and drawer rows */
      .sc-filters,
      .sc-meta,
      .drawer-row {
        margin-top: 6px;
        margin-bottom: 6px;
      }
      /* Ensure inline styles do not override spacing for the drawer */
      .drawer-row > details {
        margin: 0 !important;
      }
      .explode-checkbox {
        display: none; /* hide native checkbox */
      }
      .explode-chip {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 4px 8px;
        border: 1px solid rgba(15, 23, 42, 0.06);
        border-radius: 6px;
        background: #ffffff;
        color: #0f172a;
        font-weight: 600;
        font-size: 13px;
        line-height: 1;
        cursor: pointer;
        user-select: none;
        margin: 4px 6px 4px 0;
      }
      /* When explode options are shown inside the central modal, stack
         them vertically and make each chip expand to full modal width for
         easier tapping on touch devices. */
      #sc-explode-modal .explode-controls {
        display: flex;
        flex-direction: column;
        gap: 8px;
        align-items: stretch;
      }
      #sc-explode-modal .explode-chip {
        display: inline-flex;
        width: 100%;
        justify-content: flex-start;
        padding: 8px 12px;
        margin: 0;
      }
      /* Compact checkbox square to the left of the label */
      .explode-chip::before {
        content: "";
        display: inline-block;
        width: 14px;
        height: 14px;
        border: 1px solid rgba(15, 23, 42, 0.12);
        border-radius: 3px;
        background: transparent;
        box-sizing: border-box;
        margin-left: -2px;
      }
      /* Checked state: show a filled box with white tick */
      .explode-checkbox:checked + .explode-chip::before {
        content: "\2713";
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: #ffffff;
        background: #0a62c3;
        border-color: #0a62c3;
        font-size: 11px;
        line-height: 1;
      }
      /* Focus ring for keyboard users */
      .explode-checkbox:focus + .explode-chip {
        box-shadow: 0 0 0 4px rgba(10, 98, 195, 0.08);
        outline: none;
      }

      /* Keep Item column as a normal table cell so borders and sticky
         headers align with the rest of the table. Use inline children to
         layout the details button and item name without changing the
         table-cell behaviour. */
      th.col-item {
        min-width: 0;
      }
      td.col-item {
        display: table-cell; /* preserve table layout & borders */
        vertical-align: middle;
        padding: 8px;
        text-align: left;
      }
      /* Inline layout for the button + name inside the table-cell. Keep the
         details button fixed-size and allow the item name to flex to the
         available space so it doesn't create empty gaps. */
      .sc-item-inner {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        width: 100%;
      }
      td.col-item > .sc-item-inner {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .sc-item-inner > .sc-row-details {
        flex: 0 0 auto;
      }
      .sc-item-inner > .sc-item-name,
      td.col-item .sc-item-name {
        display: block;
        flex: 1 1 auto;
        min-width: 0; /* allow flex child to shrink */
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap; /* default: ellipsize long names */
      }

      /* Keep pills on one line on narrow devices; reduce sizes to fit */
      @media (max-width: 680px) {
        .sc-meta {
          gap: 6px;
          align-items: center;
          flex-wrap: nowrap;
        }
        .sc-pill {
          padding: 4px 8px;
          font-size: 11px;
          max-width: 160px;
          min-height: 30px;
        }
        th.col-item {
          min-width: 0;
        }
        td.col-item {
          min-width: 0;
        }
        /* Allow item name to wrap on small screens at word boundaries so
           it uses available space without breaking letters. */
        td.col-item > .sc-item-name,
        td.col-item .sc-item-name {
          white-space: normal;
          overflow-wrap: break-word;
          word-break: normal;
          text-overflow: clip;
          display: block;
        }
        td.col-item > .sc-row-details {
          flex: 0 0 28px;
          width: 28px;
          height: 28px;
        }
        #sc-count {
          padding: 4px 8px;
          min-width: 56px;
          max-width: 140px;
        }
        #sc-total-value {
          padding: 4px 8px;
          max-width: 220px;
          min-width: 84px;
        }
        .pagination .pbtn-label {
          display: none;
        }
      }
      #sc-table thead th .sc-sort-indicator {
        display: inline-block;
        margin-left: 6px;
        font-size: 1.05em;
        font-weight: 700;
        line-height: 1;
        color: #3f3f46;
        transition: color 0.12s ease, transform 0.12s ease, opacity 0.12s ease;
        opacity: 1;
        z-index: 2;
      }
      #sc-table thead th:hover .sc-sort-indicator {
        color: #111827;
      }
      #sc-table thead th.sort-asc {
        background: #e6f6ff; /* solid light blue */
      }
      #sc-table thead th.sort-asc .sc-sort-indicator {
        color: #0369a1;
        transform: translateY(-1px);
      }
      #sc-table thead th.sort-desc {
        background: #fff0f2; /* solid light red/pink */
      }
      #sc-table thead th.sort-desc .sc-sort-indicator {
        color: #9b111e;
        transform: translateY(1px);
      }
      /* Hide value columns by default, show when table has show-value class */
      .col-value {
        display: none;
      }

      .show-value .col-value {
        display: table-cell;
      }
      /* Light vertical inner borders for sc-table columns (page-local) */
      #sc-table {
        border-collapse: collapse;
      }
      #sc-table thead th:not(:first-child),
      #sc-table tbody td:not(:first-child) {
        border-left: 1px solid rgba(15, 23, 42, 0.12);
      }
      #sc-table thead th {
        border-bottom: 1px solid rgba(15, 23, 42, 0.12);
      }
      /* Extra-tight paginator tweaks for very small screens */
      @media (max-width: 420px) {
        .pagination {
          gap: 4px;
          flex-wrap: nowrap;
        }
        .pagination .sc-btn {
          width: 32px;
          min-width: 32px;
          padding: 6px;
          border-radius: 6px;
        }
        .pagination .sc-btn svg {
          width: 14px;
          height: 14px;
        }
        .pagination .pbtn-label {
          display: none !important;
        }
        /* Tighten table padding on narrow screens to avoid wrapping */
        #sc-table thead th,
        #sc-table tbody td {
          padding: 6px;
        }
        /* Reduce min-widths on small screens to fit more columns */
        /* Allow columns to shrink on very small screens so layout doesn't gap */
        th.col-item {
          min-width: 0;
        }
        td.col-item {
          min-width: 0;
        }
        th.col-meta,
        td.col-meta,
        th.col-stock,
        td.col-stock,
        th.col-demand,
        td.col-demand,
        th.col-mos,
        td.col-mos,
        th.col-overall,
        td.col-overall {
          min-width: 0;
        }
      }
      @media (max-width: 380px) {
        .pagination {
          gap: 4px;
          flex-wrap: nowrap;
        }
        .pagination .sc-btn {
          width: 30px;
          min-width: 30px;
          padding: 5px;
        }
        .pagination .sc-btn svg {
          width: 12px;
          height: 12px;
        }
        /* Reduce meta gap slightly to help fit pill + paginator */
        .sc-meta {
          gap: 4px;
        }
      }
    </style>
  </head>
  <body data-theme="system" style="padding: 20px">
    <div class="sc-header">
      <h2 style="margin: 0; color: #005a8d">Stock Checker</h2>
      <div class="sc-actions">
        <button
          id="sc-total-value"
          class="sc-pill sc-pill-icon"
          aria-haspopup="dialog"
          aria-label="Open value summary"
          title="Open value summary"
          style="margin-right: 4px; cursor: pointer"
        >
          <svg
            viewBox="0 0 24 24"
            aria-hidden="true"
            focusable="false"
            xmlns="http://www.w3.org/2000/svg"
            preserveAspectRatio="xMidYMid meet"
          >
            <text
              x="50%"
              y="50%"
              font-size="14"
              font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif"
              fill="currentColor"
              text-anchor="middle"
              dominant-baseline="central"
            >
              ₹
            </text>
          </svg>
          <span class="sc-pill-text">Value: ₹ —</span>
        </button>
        <div
          id="sc-updated"
          class="sc-snapshot"
          tabindex="0"
          role="button"
          aria-haspopup="true"
          aria-expanded="false"
        >
          <span class="sc-snapshot-dot" aria-hidden="true"></span>
          <span class="sc-snapshot-label">Snapshot</span>
          <div id="sc-status-detail" style="display: none">
            Last stock snapshot: —
          </div>
        </div>

        <button
          id="sc-download"
          class="sc-btn sc-btn-icon"
          type="button"
          aria-label="Export options"
          title="Export options"
        >
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            aria-hidden="true"
          >
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
            <polyline points="7 10 12 15 17 10" />
            <line x1="12" y1="15" x2="12" y2="3" />
          </svg>
        </button>

        <button
          id="sc-filters-btn"
          class="sc-btn sc-btn-icon"
          type="button"
          aria-label="Filters"
          title="Open filters"
        >
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            aria-hidden="true"
          >
            <path d="M3 4h18l-7 9v6l-4-2v-5L3 4z" />
          </svg>
        </button>

        <button id="homeBtn" class="sc-btn" type="button" aria-label="Home">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
            <polyline points="9,22 9,12 15,12 15,22" />
          </svg>
          <span class="home-label">HOME</span>
        </button>
      </div>
    </div>

    <!-- Placeholder for filters (we will move the filters into a centered modal on demand) -->
    <div id="sc-filters-placeholder"></div>

    <!-- Export modal (opened by download icon) -->
    <div
      id="sc-export-modal"
      class="sc-modal"
      role="dialog"
      aria-hidden="true"
      aria-modal="true"
      style="display: none"
    >
      <div class="sc-modal-backdrop" data-close="true"></div>
      <div
        class="sc-modal-panel"
        role="document"
        aria-labelledby="sc-export-modal-title"
      >
        <div class="sc-modal-header">
          <h3 id="sc-export-modal-title">Export Options</h3>
          <button
            id="sc-export-modal-close"
            class="sc-btn sc-btn-icon"
            aria-label="Close export options"
          >
            ✕
          </button>
        </div>
        <div class="sc-modal-body">
          <div class="modal-actions">
            <button
              id="sc-export"
              class="sc-btn primary sc-btn-block"
              type="button"
              title="Export current filter result to CSV"
            >
              Export CSV
            </button>

            <div>
              <button
                id="sc-export-pdf"
                class="sc-btn secondary sc-btn-block"
                type="button"
                aria-haspopup="true"
                aria-expanded="false"
              >
                Stock Coverage Report ▾
              </button>
              <div
                id="sc-export-drawer"
                class="sc-export-drawer"
                role="menu"
                aria-hidden="true"
                style="display: none"
              >
                <button
                  id="sc-export-godowns"
                  class="sc-btn sc-btn-block"
                  type="button"
                >
                  Stock Coverage Report - Godowns
                </button>
                <button
                  id="sc-export-region"
                  class="sc-btn sc-btn-block"
                  type="button"
                >
                  Stock Coverage Report - Region
                </button>
                <button
                  id="sc-export-ho"
                  class="sc-btn sc-btn-block"
                  type="button"
                >
                  Stock Coverage Report - HO Depot
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters centered modal (will host the filters UI temporarily) -->
    <div
      id="sc-filters-modal"
      class="sc-modal"
      role="dialog"
      aria-hidden="true"
      aria-modal="true"
      style="display: none"
    >
      <div class="sc-modal-backdrop" data-close="true"></div>
      <div
        class="sc-modal-panel"
        role="document"
        aria-labelledby="sc-filters-modal-title"
      >
        <div class="sc-modal-header">
          <h3 id="sc-filters-modal-title">Filters</h3>
          <button
            id="sc-filters-modal-close"
            class="sc-btn sc-btn-icon"
            aria-label="Close filters"
          >
            ✕
          </button>
        </div>
        <div class="sc-modal-body" id="sc-filters-modal-body">
          <!-- Quick filters moved here (primary filters live on the page) -->
          <div
            class="sc-quick-modal"
            style="margin-bottom: 8px; display: flex; gap: 8px"
          >
            <button
              id="qf-moslt3"
              class="chip"
              type="button"
              aria-pressed="false"
            >
              MOS &lt; 3
            </button>
            <button
              id="qf-raso"
              class="chip"
              type="button"
              aria-pressed="false"
            >
              Rasoushadhi
            </button>
          </div>
          <!-- Classification and Advanced filters only (primary filters live on the page) -->
          <details id="drawer-classification" class="drawer">
            <summary class="drawer-summary drawer-summary-classif">
              <svg
                class="chev"
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                aria-hidden="true"
                focusable="false"
              >
                <path
                  d="M9 6l6 6-6 6"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <span>Classification Filters</span>
            </summary>

            <div class="drawer-body drawer-grid">
              <label>
                Category
                <select id="drawer-cat">
                  <option value="">All</option>
                </select>
              </label>

              <label>
                Sub-category
                <select id="drawer-subcat">
                  <option value="">All</option>
                </select>
              </label>

              <label>
                Product Group
                <select id="drawer-pgroup">
                  <option value="">All</option>
                </select>
              </label>

              <label>
                Sub-group
                <select id="drawer-sgroup">
                  <option value="">All</option>
                </select>
              </label>
            </div>
          </details>

          <details id="drawer-advanced" class="drawer">
            <summary class="drawer-summary drawer-summary-adv">
              <svg
                class="chev"
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                aria-hidden="true"
                focusable="false"
              >
                <path
                  d="M9 6l6 6-6 6"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <span>Advanced Filters</span>
            </summary>

            <div class="drawer-body">
              <h4 class="drawer-heading">
                Exclude (ANY selected will be excluded)
              </h4>
              <div class="drawer-grid">
                <label>
                  <div class="multi-checkbox">
                    <button
                      type="button"
                      class="multi-btn"
                      data-target="ex-cat-list"
                    >
                      Select categories to exclude
                    </button>
                    <div class="multi-list" id="ex-cat-list" hidden></div>
                    <select id="ex-cat" multiple style="display: none"></select>
                  </div>
                </label>
                <label>
                  <div class="multi-checkbox">
                    <button
                      type="button"
                      class="multi-btn"
                      data-target="ex-subcat-list"
                    >
                      Select sub-categories to exclude
                    </button>
                    <div class="multi-list" id="ex-subcat-list" hidden></div>
                    <select
                      id="ex-subcat"
                      multiple
                      style="display: none"
                    ></select>
                  </div>
                </label>
                <label>
                  <div class="multi-checkbox">
                    <button
                      type="button"
                      class="multi-btn"
                      data-target="ex-pgroup-list"
                    >
                      Select groups to exclude
                    </button>
                    <div class="multi-list" id="ex-pgroup-list" hidden></div>
                    <select
                      id="ex-pgroup"
                      multiple
                      style="display: none"
                    ></select>
                  </div>
                </label>
                <label>
                  <div class="multi-checkbox">
                    <button
                      type="button"
                      class="multi-btn"
                      data-target="ex-sgroup-list"
                    >
                      Select sub-groups to exclude
                    </button>
                    <div class="multi-list" id="ex-sgroup-list" hidden></div>
                    <select
                      id="ex-sgroup"
                      multiple
                      style="display: none"
                    ></select>
                  </div>
                </label>
              </div>

              <!-- MOS rows (kept short) -->
              <h4 class="drawer-heading">MOS Filters</h4>
              <div class="mos-row">
                <label class="mos-label" for="mosik-v1">MOS IK</label>
                <select id="mosik-op" aria-label="MOS IK operator">
                  <option value="gt">&gt;</option>
                  <option value="gte">&ge;</option>
                  <option value="eq">=</option>
                  <option value="lte">&le;</option>
                  <option value="lt">&lt;</option>
                  <option value="between">Between</option>
                </select>
                <input
                  id="mosik-v1"
                  type="number"
                  step="0.01"
                  inputmode="decimal"
                  placeholder="value"
                  aria-label="MOS IK value"
                />
                <input
                  id="mosik-v2"
                  type="number"
                  step="0.01"
                  inputmode="decimal"
                  placeholder="max"
                  aria-label="MOS IK max value"
                />
                <label class="nullchk"
                  ><input id="mosik-nnull" type="checkbox" />Exclude
                  nulls</label
                >
              </div>
              <!-- MOS KKD -->
              <div class="mos-row">
                <label class="mos-label" for="moskkd-v1">MOS KKD</label>

                <select id="moskkd-op" aria-label="MOS KKD operator">
                  <option value="gt">&gt;</option>
                  <option value="gte">&ge;</option>
                  <option value="eq">=</option>
                  <option value="lte">&le;</option>
                  <option value="lt">&lt;</option>
                  <option value="between">Between</option>
                </select>

                <input
                  id="moskkd-v1"
                  type="number"
                  step="0.01"
                  inputmode="decimal"
                  placeholder="value"
                  aria-label="MOS KKD value"
                />

                <input
                  id="moskkd-v2"
                  type="number"
                  step="0.01"
                  inputmode="decimal"
                  placeholder="max"
                  aria-label="MOS KKD max value"
                />

                <label class="nullchk">
                  <input id="moskkd-nnull" type="checkbox" />Exclude nulls
                </label>
              </div>

              <!-- MOS OK -->
              <div class="mos-row">
                <label class="mos-label" for="mosok-v1">MOS OK</label>

                <select id="mosok-op" aria-label="MOS OK operator">
                  <option value="gt">&gt;</option>
                  <option value="gte">&ge;</option>
                  <option value="eq">=</option>
                  <option value="lte">&le;</option>
                  <option value="lt">&lt;</option>
                  <option value="between">Between</option>
                </select>

                <input
                  id="mosok-v1"
                  type="number"
                  step="0.01"
                  inputmode="decimal"
                  placeholder="value"
                  aria-label="MOS OK value"
                />

                <input
                  id="mosok-v2"
                  type="number"
                  step="0.01"
                  inputmode="decimal"
                  placeholder="max"
                  aria-label="MOS OK max value"
                />

                <label class="nullchk">
                  <input id="mosok-nnull" type="checkbox" />Exclude nulls
                </label>
              </div>

              <!-- MOS Overall -->
              <div class="mos-row">
                <label class="mos-label" for="mosov-v1">MOS Overall</label>

                <select id="mosov-op" aria-label="MOS Overall operator">
                  <option value="gt">&gt;</option>
                  <option value="gte">&ge;</option>
                  <option value="eq">=</option>
                  <option value="lte">&le;</option>
                  <option value="lt">&lt;</option>
                  <option value="between">Between</option>
                </select>

                <input
                  id="mosov-v1"
                  type="number"
                  step="0.01"
                  inputmode="decimal"
                  placeholder="value"
                  aria-label="MOS Overall value"
                />

                <input
                  id="mosov-v2"
                  type="number"
                  step="0.01"
                  inputmode="decimal"
                  placeholder="max"
                  aria-label="MOS Overall max value"
                />

                <label class="nullchk">
                  <input id="mosov-nnull" type="checkbox" />Exclude nulls
                </label>
              </div>
              <div class="drawer-actions">
                <span
                  id="adv-count"
                  class="sc-pill"
                  style="margin-left: auto; display: none"
                ></span>
              </div>
            </div>
          </details>
        </div>
        <div
          class="sc-modal-footer"
          style="
            padding: 12px 16px;
            border-top: 1px solid #f1f5f9;
            display: flex;
            gap: 8px;
            justify-content: flex-end;
          "
        >
          <button
            id="sc-clear"
            class="sc-btn secondary"
            type="button"
            aria-label="Reset filters"
            style="margin-right: auto"
          >
            Reset Filters
          </button>
          <button id="sc-filters-cancel" class="sc-btn" type="button">
            Cancel
          </button>
          <button id="sc-filters-apply" class="sc-btn primary" type="button">
            Apply
          </button>
        </div>
      </div>
    </div>

    <!-- Explode Options modal (opened by explode-details button) -->
    <div
      id="sc-explode-modal"
      class="sc-modal"
      role="dialog"
      aria-hidden="true"
      aria-modal="true"
      style="display: none"
    >
      <div class="sc-modal-backdrop" data-close="true"></div>
      <div
        class="sc-modal-panel"
        role="document"
        aria-labelledby="sc-explode-modal-title"
      >
        <div class="sc-modal-header">
          <h3 id="sc-explode-modal-title">Explode Options</h3>
          <button
            id="sc-explode-modal-close"
            class="sc-btn sc-btn-icon"
            aria-label="Close explode options"
          >
            ✕
          </button>
        </div>
        <div class="sc-modal-body" style="padding: 12px 16px">
          <div
            class="explode-controls"
            style="display: flex; flex-wrap: wrap; gap: 8px; padding: 8px"
          >
            <input
              id="explode-stock"
              class="explode-checkbox"
              type="checkbox"
              aria-label="Explode Stock"
            />
            <label for="explode-stock" class="explode-chip"
              >Explode Stock</label
            >

            <input
              id="explode-demand"
              class="explode-checkbox"
              type="checkbox"
              aria-label="Explode Demand"
            />
            <label for="explode-demand" class="explode-chip"
              >Explode Demand</label
            >

            <input
              id="explode-mos"
              class="explode-checkbox"
              type="checkbox"
              aria-label="Explode MOS"
            />
            <label for="explode-mos" class="explode-chip">Explode MOS</label>

            <input
              id="toggle-value"
              class="explode-checkbox"
              type="checkbox"
              aria-label="Show Value"
            />
            <label for="toggle-value" class="explode-chip">Show Value</label>
          </div>
        </div>
      </div>
    </div>

    <!-- Primary filters (Item / Pack Size) and quick chips restored here -->
    <section class="sc-filters">
      <label style="position: relative">
        Item
        <div class="autocomplete input-with-icon" style="position: relative">
          <input
            id="sc-item"
            type="text"
            placeholder="Type to search item…"
            autocomplete="off"
            aria-autocomplete="list"
            aria-haspopup="listbox"
          />
          <button
            id="sc-item-clear"
            class="input-clear-btn"
            type="button"
            aria-label="Clear Item"
            title="Clear Item"
          >
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              aria-hidden="true"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
          <div
            id="sc-item-list"
            class="ac-list"
            role="listbox"
            aria-label="Item suggestions"
            hidden
          ></div>
        </div>
      </label>

      <label class="uom-inline">
        <span>Pack Size</span>
        <div class="pack-uom input-with-icon">
          <input
            id="sc-packsize"
            type="text"
            inputmode="numeric"
            pattern="\d*"
            placeholder="e.g. 450"
          />
          <button
            id="sc-packsize-clear"
            class="input-clear-btn"
            type="button"
            aria-label="Clear Pack Size"
            title="Clear Pack Size"
          >
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              aria-hidden="true"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
          <span id="sc-uom" class="uom-text" aria-live="polite"></span>
        </div>
      </label>
    </section>

    <!-- quick filters moved into modal -->

    <!-- Meta row: counts + last updated + pagination -->
    <div class="sc-meta">
      <!-- paginator moved below next to Explode Details -->
    </div>

    <div
      class="drawer-row"
      style="display: flex; align-items: center; gap: 8px"
    >
      <!-- Explode details: icon-only button opens central modal (inputs moved to modal) -->
      <div style="display: flex; align-items: center; gap: 8px; margin: 12px 0">
        <button
          id="explode-details-btn"
          class="sc-btn sc-btn-icon"
          type="button"
          aria-label="Explode options"
          title="Explode options"
        >
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            aria-hidden="true"
          >
            <path d="M12 2v6" stroke-linecap="round" stroke-linejoin="round" />
            <path
              d="M12 22v-6"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path d="M4 12h6" stroke-linecap="round" stroke-linejoin="round" />
            <path d="M14 12h6" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
        </button>
      </div>
      <div class="pagination" style="margin-left: auto">
        <button
          id="sc-prev"
          class="sc-btn"
          type="button"
          disabled
          title="Previous page"
          aria-label="Previous page"
        >
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            aria-hidden="true"
          >
            <path d="M15 6l-6 6 6 6" />
          </svg>
          <span class="pbtn-label">Prev</span>
        </button>
        <span id="sc-page" style="display: inline-flex; align-items: center"
          >Page 1</span
        >
        <button
          id="sc-next"
          class="sc-btn"
          type="button"
          disabled
          title="Next page"
          aria-label="Next page"
        >
          <span class="pbtn-label">Next</span>
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            aria-hidden="true"
          >
            <path d="M9 6l6 6-6 6" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Results table -->
    <div class="table-wrap">
      <table id="sc-table" class="collapsed-default">
        <thead>
          <tr>
            <th class="col-item" style="text-align: center">Item</th>
            <th class="col-meta" style="text-align: center">Pack Size</th>
            <th class="col-meta" style="text-align: center">UOM</th>
            <th class="col-stock" style="text-align: center">Stock IK</th>
            <th class="col-stock" style="text-align: center">Stock KKD</th>
            <th class="col-stock" style="text-align: center">Stock OK</th>
            <th class="col-overall" style="text-align: center">
              Stock (overall)
            </th>
            <th class="col-value" style="text-align: center">Value IK</th>
            <th class="col-value" style="text-align: center">Value KKD</th>
            <th class="col-value" style="text-align: center">Value OK</th>
            <th class="col-value" style="text-align: center">
              Value (overall)
            </th>
            <th class="col-demand" style="text-align: center">Demand IK</th>
            <th class="col-demand" style="text-align: center">Demand KKD</th>
            <th class="col-demand" style="text-align: center">Demand OK</th>
            <th class="col-overall" style="text-align: center">
              Demand (overall)
            </th>
            <th class="col-mos" style="text-align: center">MOS IK</th>
            <th class="col-mos" style="text-align: center">MOS KKD</th>
            <th class="col-mos" style="text-align: center">MOS OK</th>
            <th class="col-overall" style="text-align: center">
              MOS (overall)
            </th>
          </tr>
        </thead>
        <tbody id="sc-body">
          <!-- rows injected by JS (Step C) -->
        </tbody>
      </table>
    </div>

    <!-- Stock Value Summary Modal -->
    <div
      id="sc-value-modal"
      class="sc-modal"
      role="dialog"
      aria-modal="true"
      style="display: none"
    >
      <div class="sc-modal-backdrop" data-close="true"></div>
      <div
        class="sc-modal-panel"
        role="document"
        aria-labelledby="sc-value-modal-title"
      >
        <div class="sc-modal-header">
          <h3 id="sc-value-modal-title">Stock Value Summary</h3>
          <button
            id="sc-value-modal-close"
            class="sc-btn sc-btn-icon"
            aria-label="Close"
          >
            ✕
          </button>
        </div>
        <div class="sc-modal-body" id="sc-value-modal-body">
          <div
            id="sc-value-modal-count"
            style="margin-bottom: 8px; color: var(--muted)"
          >
            Product SKUs: — nos
          </div>
          <div id="sc-value-body-content">Calculating…</div>
        </div>
        <div
          class="sc-modal-footer"
          id="sc-value-modal-footer"
          style="padding: 12px 16px; border-top: 1px solid #f1f5f9"
        >
          <small id="sc-value-snapshot">Snapshot: —</small>
        </div>
      </div>
    </div>

    <!-- Row details modal -->
    <div
      id="sc-row-modal"
      class="sc-modal"
      role="dialog"
      aria-modal="true"
      style="display: none"
    >
      <div class="sc-modal-backdrop" data-close="true"></div>
      <div
        class="sc-modal-panel"
        role="document"
        aria-labelledby="sc-row-modal-title"
      >
        <div class="sc-modal-header">
          <h3 id="sc-row-modal-title">Item Details</h3>
          <button
            id="sc-row-modal-close"
            class="sc-btn sc-btn-icon"
            aria-label="Close"
          >
            ✕
          </button>
        </div>
        <div class="sc-modal-body" id="sc-row-modal-body">
          <div id="sc-row-header" style="margin-bottom: 12px"></div>
          <div
            id="sc-row-classif"
            style="color: var(--muted); font-size: 0.95rem; margin-bottom: 8px"
          ></div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px">
            <div
              id="sc-row-qty"
              style="
                background: #fff;
                padding: 8px;
                border-radius: 6px;
                border: 1px solid var(--border);
              "
            ></div>
            <div
              id="sc-row-value"
              style="
                background: #fff;
                padding: 8px;
                border-radius: 6px;
                border: 1px solid var(--border);
              "
            ></div>
          </div>
        </div>
        <div
          class="sc-modal-footer"
          style="padding: 12px 16px; border-top: 1px solid #f1f5f9"
        >
          <small id="sc-row-footer-info"></small>
        </div>
      </div>
    </div>

    <!-- Inline message area -->
    <div id="sc-msg" style="padding: 10px; color: #b45309"></div>

    <!-- TomSelect removed: using custom paginated autocomplete -->

    <!-- jsPDF + AutoTable (for table PDF) -->
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.3/dist/jspdf.plugin.autotable.min.js"></script>

    <!-- JS entry (we’ll implement in Step C) -->
    <script type="module" src="js/stock-checker.js"></script>
  </body>
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker
        .register("/public/sw.js", { scope: "/public/" })
        .catch(console.error);
    }
  </script>
</html>
