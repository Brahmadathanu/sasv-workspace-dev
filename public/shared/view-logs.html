<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="UTF-8" />
    <title>SASV WORKSPACE | View Logs</title>

    <!-- Flatpickr date-picker (local build lives in /css) -->
    <link rel="stylesheet" href="../vendor/flatpickr.min.css" />
    <link
      rel="stylesheet"
      href="../vendor/plugins/confirmDate/confirmDate.css"
    />

    <!-- Tom Select -->
    <link rel="stylesheet" href="../vendor/tom-select/tom-select.css" />

    <!-- Shared global design-token + component styles -->
    <link rel="stylesheet" href="./css/style.css" />

    <!-- Per-page tweaks -->
    <style>
      /* ─── LAYOUT / THEME ─────────────────────────────────────────────── */
      body {
        background: var(--bg-color);
        color: var(--text-color);
        font-family: Arial, sans-serif;
        margin: 20px;
        transition: background 0.3s, color 0.3s;
      }

      /* Page header (use same structure as production pages) */
      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }
      .page-header h1 {
        margin: 0;
        color: var(--primary);
        font-size: 1.5rem;
      }

      /* Per-page nudge to fix tiny vertical misalignment of HOME label
         when rendered in this page's header. Keeps change scoped to
         view-logs only. */
      .page-header #homeBtn .home-label {
        position: relative;
        top: 1px; /* nudge down by 1px */
        display: inline-block;
      }
      /* Home button styling is provided by the shared stylesheet (style.css) */
      /* group BACK + HOME at right edge */
      .header-actions {
        display: flex;
        gap: 8px;
        margin-left: auto;
      }

      /* ─── PRIMARY FILTER STRIP ─────────────────────────────────────────── */
      .filter-strip {
        display: flex;
        flex-wrap: wrap;
        gap: 8px 8px;
        align-items: center;
        margin-bottom: 12px;
      }
      .filter-strip .filter-pair {
        /* base width but can shrink/grow */
        flex: 1 1 180px;
        min-width: 120px;
        display: flex;
        gap: 8px;
        align-items: center;
      }

      /* make the date input sit nicely */
      .log-date {
        min-width: 120px;
      }

      /* a handy narrow class for the BN dropdown */
      .narrow {
        min-width: 80px;
      }

      /* Allow children to shrink instead of overflowing/overlapping */
      .filter-pair > * {
        min-width: 0 !important;
        flex: 1 1 0;
      }

      /* /* Make the Item/BN pair responsive */
      .filter-pair.item-bn {
        display: grid;
        grid-template-columns: 1.5fr 0.8fr; /* first column fills remaining, second hugs content */
        gap: 8px;
        min-width: 0; /* allow it to shrink below its own content if needed */
      }

      /* ensure the children themselves can shrink inside the grid */
      .filter-pair.item-bn > * {
        min-width: 0;
      }

      .narrow {
        min-width: 60px; /* Slightly narrower for BN */
        max-width: 110px;
      }

      /* ─── ADVANCED FILTER ROW ──────────────────────────────────────────── */
      .filter-row {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 12px;
      }
      .filter-row .filter-pair {
        flex: 1 1 280px; /* Slightly wider base */
        min-width: 220px;
        gap: 8px;
      }
      .filter-row .filter-pair select {
        min-width: 0;
        flex: 1 1 50%;
      }

      /* shared inputs/select styling */
      .filter-pair select,
      .filter-pair input[type="text"] {
        flex: 1;
        padding: 6px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
      }

      /* ─── ACTION BUTTON GROUP ───────────────────────────────────────────── */
      .filter-actions {
        display: flex;
        gap: 8px;
        margin-left: auto;
        align-items: center;
      }

      /* hyperlink‑style buttons */
      .link-btn {
        background: none;
        border: none;
        padding: 4px 8px;
        color: #007bff;
        text-decoration: none;
        font-size: 0.9rem;
        cursor: pointer;
      }
      .link-btn:hover {
        background: rgba(0, 123, 255, 0.1);
      }
      .link-btn:focus {
        outline: 2px solid rgba(0, 123, 255, 0.6);
        outline-offset: 2px;
      }

      /* ─── EXPORT LINKS ───────────────────────────────────────────────── */
      #exportLinks {
        display: flex;
        justify-content: space-between;
        width: 100%;
        margin: 4px 0 12px;
      }
      #exportLinks span {
        color: var(--primary);
        text-decoration: underline;
        cursor: pointer;
        font-size: 14px;
      }
      #exportLinks span:hover {
        color: var(--primary-hover);
      }

      /* ─── TABLE ──────────────────────────────────────────────────────── */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 24px;
      }
      th,
      td {
        padding: 4px 6px;
        border: 1px solid #ccc;
        text-align: left;
        font-size: 14px;
        line-height: 1.2;
      }
      tr {
        height: 28px;
      }
      a.view-link {
        color: var(--primary);
        text-decoration: underline;
        cursor: pointer;
      }
      a.view-link:hover {
        color: var(--primary-hover);
      }

      /* Zebra striping */
      table tbody tr:nth-child(even) {
        background-color: #f6f9fb;
      }

      /* Hover highlight */
      table tbody tr:hover {
        background-color: #e9f3fc;
        cursor: pointer;
      }

      /* ─── MODAL ──────────────────────────────────────────────────────── */
      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.4);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }
      .modal-box {
        background: var(--panel-bg);
        color: var(--text-color);
        padding: 24px;
        border-radius: 8px;
        width: 95%;
        max-width: 620px;
        max-height: 85vh;
        overflow: auto;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
      }
      .modal-box h3 {
        margin: 0 0 16px;
      }
      .modal-actions {
        text-align: right;
        margin-top: 24px;
      }
      .btn {
        background: var(--btn-bg);
        color: var(--btn-text);
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
      }
      .btn:hover {
        background: var(--btn-hover-bg);
      }

      /* === Tom Select Field Uniformity === */
      .ts-wrapper,
      .ts-control {
        width: 100% !important;
        min-width: 0 !important;
        box-sizing: border-box;
        display: flex;
        align-items: center;
      }
      .ts-control {
        min-height: 34px;
        padding: 0 6px;
        font-size: 14px;
        background: #fff;
        border-radius: 4px;
      }
      .ts-dropdown {
        font-size: 14px;
      }
      .plant-quick-filter {
        padding: 6px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
        margin-bottom: 6px;
        width: 100%;
        box-sizing: border-box;
      }

      /* Make the two advanced pairs share the row equally */
      #filtersAdvanced.filter-row {
        display: grid;
        grid-template-columns: repeat(2, minmax(260px, 1fr));
        gap: 12px 20px;
      }

      /* Inside each pair, make the two controls equal width */
      #filtersAdvanced .filter-pair {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }

      /* Tom Select: keep fonts normal and consistent */
      .ts-control,
      .ts-dropdown,
      .ts-dropdown .option {
        font-family: inherit;
        font-size: 14px;
        font-weight: 400;
      }
    </style>
  </head>

  <body data-theme="system">
    <!-- ===== Page Header (production-style) ===== -->
    <header class="page-header">
      <h1>View Logs</h1>
      <div class="header-actions">
        <button id="homeBtn">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
            <polyline points="9,22 9,12 15,12 15,22" />
          </svg>
          <span class="home-label">HOME</span>
        </button>
      </div>
    </header>

    <!-- ===== Primary Filter Strip ===== -->
    <div id="filtersPrimary" class="filter-strip">
      <!-- Log Date -->
      <div class="filter-pair">
        <input
          id="filterDate"
          class="log-date"
          type="text"
          placeholder="dd-mm-yyyy"
          autocomplete="off"
        />
      </div>

      <!-- Item / BN -->
      <div class="filter-pair item-bn">
        <select id="filterItem" placeholder="Item"></select>
        <select id="filterBN" class="narrow" disabled>
          <option value="">BN</option>
        </select>
      </div>

      <!-- Activity -->
      <div class="filter-pair">
        <select id="filterActivity" placeholder="Activity"></select>
      </div>

      <!-- Status -->
      <div class="filter-pair">
        <select id="filterStatus">
          <option value="">Status</option>
          <option>Doing</option>
          <option>Done</option>
          <option>In Storage</option>
          <option>On Hold</option>
        </select>
      </div>

      <!-- Actions: Advanced toggle + Clear -->
      <div class="filter-actions">
        <button id="toggleAdvanced" class="link-btn">Advanced ▾</button>
        <span id="clearFilters" class="link-btn">Clear</span>
      </div>
    </div>

    <!-- ===== Advanced Filter Row ===== -->
    <div id="filtersAdvanced" class="filter-row" style="display: none">
      <!-- Section / Sub‑section -->
      <div class="filter-pair">
        <select id="filterSection">
          <option value="">Section</option>
        </select>
        <select id="filterSubsection" disabled>
          <option value="">Sub-section</option>
        </select>
      </div>

      <!-- Area / Plant -->
      <div class="filter-pair">
        <select id="filterArea" disabled>
          <option value="">Area</option>
        </select>

        <!-- Regular <select>; Tom Select will enhance it -->
        <select id="filterPlant" disabled>
          <option value="">Plant / Machinery</option>
        </select>
      </div>
    </div>

    <!-- ===== Export links ===== -->
    <div id="exportLinks">
      <span id="downloadCsv">Download CSV</span>
      <span id="downloadPdf">Download PDF</span>
    </div>

    <!-- ===== Logs table (scrollable container) ===== -->
    <div class="table-scroll-wrap" id="logsTableWrap">
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Item</th>
            <th>BN</th>
            <th>Batch Size</th>
            <th>UOM</th>
            <th>Section</th>
            <th>Plant&nbsp;/&nbsp;Machinery</th>
            <th>Activity</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="logsTableBody"></tbody>
      </table>
    </div>

    <!-- Pagination controls (styled like Forecast Console Overrides) -->
    <div class="pagination" id="logsPagination">
      <div class="pagination-controls">
        <label
          class="small muted"
          for="logsPerPage"
          style="
            display: flex;
            align-items: center;
            gap: 6px;
            margin-right: 6px;
          "
          >Page Size
          <select
            id="logsPerPage"
            class="small"
            style="
              margin-left: 6px;
              padding: 4px 6px;
              border-radius: 4px;
              border: 1px solid #d1d5db;
              background: #fff;
            "
          >
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
        </label>
        <button id="logsPrev" class="btn">Previous</button>
        <span class="small muted" id="logsPageInfo">Page 1</span>
        <button id="logsNext" class="btn">Next</button>
      </div>
    </div>

    <!-- ===== Details modal ===== -->
    <div id="viewOverlay" class="modal-overlay">
      <div class="modal-box">
        <h3>Log Entry Details</h3>
        <table>
          <tbody id="detailTable"></tbody>
        </table>
        <div class="modal-actions">
          <button id="closeView" class="btn">Close</button>
        </div>
      </div>
    </div>

    <!-- Runtime deps -->
    <script src="../vendor/flatpickr.min.js"></script>
    <script src="../vendor/plugins/confirmDate/confirmDate.js"></script>

    <!-- PDF export libs (load BEFORE log-view.js) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

    <!-- Tom Select CSS & JS -->
    <script src="../vendor/tom-select/tom-select.complete.min.js"></script>

    <script type="module" src="./js/platform.js"></script>
    <script type="module" src="./js/log-view.js"></script>
  </body>
</html>
