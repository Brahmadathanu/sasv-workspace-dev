<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Signing you in…</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      body {
        font-family: system-ui, Arial, sans-serif;
        margin: 2rem;
      }
    </style>
  </head>
  <body>
    <p>Finishing sign-in… you can close this tab.</p>
    <script type="module">
      import { supabase } from "../../shared/js/supabaseClient.js";

      // 1) Let Supabase consume hash/params and write the session to localStorage
      // (Supabase does this internally on first auth call in this page; we just ensure it’s loaded.)
      // 2) Broadcast to all open app windows
      try {
        const bc = new BroadcastChannel("sasv-auth");
        bc.postMessage({ type: "signed-in" });
        bc.close();
      } catch {}

      // 3) Try to focus an existing client (installed app window) if any
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.ready.then(async (reg) => {
          const all = await reg.active?.postMessage?.("ping"); // harmless
        });
      }

      // 4) After a tiny delay, bounce to hub (in case someone opens callback direct)
      setTimeout(() => {
        window.location.replace("/utilities-hub/");
      }, 500);
    </script>
  </body>
</html>
