<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Signing you in…</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        font-family: system-ui, Arial, sans-serif;
        margin: 24px;
        color: #0b1420;
      }
      .card {
        max-width: 560px;
        margin: 12vh auto 0;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 18px;
        background: #fff;
      }
      h1 {
        font-size: 1.25rem;
        margin: 0.2rem 0;
      }
      p {
        color: #475569;
        margin: 0.4rem 0;
      }
      button {
        margin-top: 8px;
        padding: 0.6rem 1rem;
        border-radius: 8px;
        border: 1px solid #0a62c3;
        background: #0a62c3;
        color: #fff;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>Signing you in…</h1>
      <p>
        If the app is installed, it should open automatically. You can close
        this tab after it does.
      </p>
      <button id="open">Open SASV Utilities Hub</button>
    </div>

    <script type="module">
      // 1) Ask SW to wake/focus the installed PWA (Android/desktop Chromium)
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.ready
          .then((reg) => {
            // post to the active SW (works when SW controls this page)
            (reg.active || navigator.serviceWorker.controller)?.postMessage({
              type: "signed-in",
            });
          })
          .catch(() => {});
      }

      // 2) Also notify any open hub page via BroadcastChannel (works even in browsers without SW focus APIs)
      try {
        const bc = new BroadcastChannel("sasv-auth");
        bc.postMessage({ type: "signed-in" });
      } catch {}

      // 3) Manual fallback button
      document.getElementById("open")?.addEventListener("click", () => {
        location.href = "/utilities-hub/";
      });
    </script>
  </body>
</html>
