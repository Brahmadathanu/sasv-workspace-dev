<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="UTF-8" />
    <title>SASV WORKSPACE | View Logs</title>

    <!-- Flatpickr date-picker (local build lives in /css) -->
    <link rel="stylesheet" href="css/flatpickr.min.css" />

    <!-- Shared global design-token + component styles -->
    <link rel="stylesheet" href="public/shared/css/style.css" />

    <!-- Per-page tweaks -->
    <style>
      /* ─── LAYOUT / THEME ─────────────────────────────────────────────── */
      body {
        background: var(--bg-color);
        color: var(--text-color);
        font-family: Arial, sans-serif;
        margin: 20px;
        transition: background 0.3s, color 0.3s;
      }

      /* Header: title + Home button */
      .header-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }
      .header-bar h2 {
        margin: 0;
        color: var(--primary);
      }
      #homeBtn {
        background: var(--home-btn-bg);
        color: var(--btn-text);
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        font-size: 1rem;
        cursor: pointer;
      }
      #homeBtn:hover {
        background: var(--home-btn-hover-bg);
      }
      /* group BACK + HOME at right edge */
      .header-actions {
        display: flex;
        gap: 8px;
        margin-left: auto;
      }

      /* BACK = secondary gray */
      #backBtn {
        background: #6c757d;
        color: #fff;
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.2s;
      }
      #backBtn:hover {
        background: #5a6268;
      }

      /* ─── PRIMARY FILTER STRIP ─────────────────────────────────────────── */
      .filter-strip {
        display: flex;
        flex-wrap: wrap;
        gap: 8px 8px;
        align-items: center;
        margin-bottom: 12px;
      }
      .filter-strip .filter-pair {
        /* base width but can shrink/grow */
        flex: 1 1 180px;
        min-width: 120px;
        display: flex;
        gap: 8px;
        align-items: center;
      }

      /* make the date input sit nicely */
      .log-date {
        min-width: 120px;
      }

      /* a handy narrow class for the BN dropdown */
      .narrow {
        min-width: 80px;
      }

      /* Allow children to shrink instead of overflowing/overlapping */
      .filter-pair > * {
        min-width: 0 !important;
        flex: 1 1 0;
      }

      /* /* Make the Item/BN pair responsive */
      .filter-pair.item-bn {
        display: grid;
        grid-template-columns: 1.5fr 0.8fr; /* first column fills remaining, second hugs content */
        gap: 8px;
        min-width: 0; /* allow it to shrink below its own content if needed */
      }

      /* ensure the children themselves can shrink inside the grid */
      .filter-pair.item-bn > * {
        min-width: 0;
      }

      .narrow {
        min-width: 60px; /* Slightly narrower for BN */
        max-width: 110px;
      }

      /* ─── ADVANCED FILTER ROW ──────────────────────────────────────────── */
      .filter-row {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 12px;
      }
      .filter-row .filter-pair {
        flex: 1 1 280px; /* Slightly wider base */
        min-width: 220px;
        gap: 8px;
      }
      .filter-row .filter-pair select {
        min-width: 0;
        flex: 1 1 50%;
      }

      /* shared inputs/select styling */
      .filter-pair select,
      .filter-pair input[type="text"] {
        flex: 1;
        padding: 6px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
      }

      /* ─── ACTION BUTTON GROUP ───────────────────────────────────────────── */
      .filter-actions {
        display: flex;
        gap: 8px;
        margin-left: auto;
        align-items: center;
      }

      /* hyperlink‑style buttons */
      .link-btn {
        background: none;
        border: none;
        padding: 4px 8px;
        color: #007bff;
        text-decoration: none;
        font-size: 0.9rem;
        cursor: pointer;
      }
      .link-btn:hover {
        background: rgba(0, 123, 255, 0.1);
      }
      .link-btn:focus {
        outline: 2px solid rgba(0, 123, 255, 0.6);
        outline-offset: 2px;
      }

      /* ─── EXPORT LINKS ───────────────────────────────────────────────── */
      #exportLinks {
        display: flex;
        justify-content: space-between;
        width: 100%;
        margin: 4px 0 12px;
      }
      #exportLinks span {
        color: var(--primary);
        text-decoration: underline;
        cursor: pointer;
        font-size: 14px;
      }
      #exportLinks span:hover {
        color: var(--primary-hover);
      }

      /* ─── TABLE ──────────────────────────────────────────────────────── */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 24px;
      }
      th,
      td {
        padding: 4px 6px;
        border: 1px solid #ccc;
        text-align: left;
        font-size: 14px;
        line-height: 1.2;
      }
      tr {
        height: 28px;
      }
      a.view-link {
        color: var(--primary);
        text-decoration: underline;
        cursor: pointer;
      }
      a.view-link:hover {
        color: var(--primary-hover);
      }

      /* Zebra striping */
      table tbody tr:nth-child(even) {
        background-color: #f6f9fb;
      }

      /* Hover highlight */
      table tbody tr:hover {
        background-color: #e9f3fc;
        cursor: pointer;
      }

      /* ─── MODAL ──────────────────────────────────────────────────────── */
      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.4);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }
      .modal-box {
        background: var(--panel-bg);
        color: var(--text-color);
        padding: 24px;
        border-radius: 8px;
        width: 95%;
        max-width: 620px;
        max-height: 85vh;
        overflow: auto;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
      }
      .modal-box h3 {
        margin: 0 0 16px;
      }
      .modal-actions {
        text-align: right;
        margin-top: 24px;
      }
      .btn {
        background: var(--btn-bg);
        color: var(--btn-text);
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
      }
      .btn:hover {
        background: var(--btn-hover-bg);
      }

      /* === Tom Select Field Uniformity === */
      .ts-wrapper,
      .ts-control {
        width: 100% !important;
        min-width: 0 !important;
        box-sizing: border-box;
        display: flex;
        align-items: center;
      }
      .ts-control {
        min-height: 34px;
        padding: 0 6px;
        font-size: 14px;
        background: #fff;
        border-radius: 4px;
      }
      .ts-dropdown {
        font-size: 14px;
      }
      .plant-quick-filter {
        padding: 6px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
        margin-bottom: 6px;
        width: 100%;
        box-sizing: border-box;
      }

      /* Make the two advanced pairs share the row equally */
      #filtersAdvanced.filter-row {
        display: grid;
        grid-template-columns: repeat(2, minmax(260px, 1fr));
        gap: 12px 20px;
      }

      /* Inside each pair, make the two controls equal width */
      #filtersAdvanced .filter-pair {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }

      /* Tom Select: keep fonts normal and consistent */
      .ts-control,
      .ts-dropdown,
      .ts-dropdown .option {
        font-family: inherit;
        font-size: 14px;
        font-weight: 400;
      }
    </style>
  </head>

  <body data-theme="system">
    <!-- ===== Header bar ===== -->
    <div class="header-bar">
      <h2>View Logs</h2>
      <div class="header-actions">
        <button id="backBtn">BACK</button>
        <button id="homeBtn">HOME</button>
      </div>
    </div>

    <!-- ===== Primary Filter Strip ===== -->
    <div id="filtersPrimary" class="filter-strip">
      <!-- Log Date -->
      <div class="filter-pair">
        <input
          id="filterDate"
          class="log-date"
          type="text"
          placeholder="dd-mm-yyyy"
          autocomplete="off"
        />
      </div>

      <!-- Item / BN -->
      <div class="filter-pair item-bn">
        <select id="filterItem" placeholder="Item"></select>
        <select id="filterBN" class="narrow" disabled>
          <option value="">BN</option>
        </select>
      </div>

      <!-- Activity -->
      <div class="filter-pair">
        <select id="filterActivity" placeholder="Activity"></select>
      </div>

      <!-- Status -->
      <div class="filter-pair">
        <select id="filterStatus">
          <option value="">Status</option>
          <option>Doing</option>
          <option>Done</option>
          <option>In Storage</option>
          <option>On Hold</option>
        </select>
      </div>

      <!-- Actions: Advanced toggle + Clear -->
      <div class="filter-actions">
        <button id="toggleAdvanced" class="link-btn">Advanced ▾</button>
        <span id="clearFilters" class="link-btn">Clear</span>
      </div>
    </div>

    <!-- ===== Advanced Filter Row ===== -->
    <div id="filtersAdvanced" class="filter-row" style="display: none">
      <!-- Section / Sub‑section -->
      <div class="filter-pair">
        <select id="filterSection">
          <option value="">Section</option>
        </select>
        <select id="filterSubsection" disabled>
          <option value="">Sub-section</option>
        </select>
      </div>

      <!-- Area / Plant -->
      <div class="filter-pair">
        <select id="filterArea" disabled>
          <option value="">Area</option>
        </select>

        <!-- Regular <select>; Tom Select will enhance it -->
        <select id="filterPlant" disabled>
          <option value="">Plant / Machinery</option>
        </select>
      </div>
    </div>

    <!-- ===== Export links ===== -->
    <div id="exportLinks">
      <span id="downloadCsv">Download CSV</span>
      <span id="downloadPdf">Download PDF</span>
    </div>

    <!-- ===== Logs table ===== -->
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Item</th>
          <th>BN</th>
          <th>Batch Size</th>
          <th>UOM</th>
          <th>Section</th>
          <th>Plant&nbsp;/&nbsp;Machinery</th>
          <th>Activity</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="logsTableBody"></tbody>
    </table>

    <!-- ===== Details modal ===== -->
    <div id="viewOverlay" class="modal-overlay">
      <div class="modal-box">
        <h3>Log Entry Details</h3>
        <table>
          <tbody id="detailTable"></tbody>
        </table>
        <div class="modal-actions">
          <button id="closeView" class="btn">Close</button>
        </div>
      </div>
    </div>

    <!-- Runtime deps -->
    <script src="css/flatpickr.min.js"></script>
    <script src="css/plugins/confirmDate/confirmDate.js"></script>

    <!-- PDF export libs (load BEFORE log-view.js) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

    <!-- Tom Select CSS & JS -->
    <link
      href="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/css/tom-select.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/js/tom-select.complete.min.js"></script>

    <script type="module" src="js/log-view.js"></script>
  </body>
</html>
